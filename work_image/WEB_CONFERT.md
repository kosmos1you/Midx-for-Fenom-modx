# Webp конвертер для MODX Revo

WebP — современный графический формат для веб сайтов, разработанный компанией Google в 2010 году. На данный момент этот формат поддерживают все современные браузеры, кроме устаревшего IE, https://caniuse.com/#feat=webp

Основных причин использования формата WebP несколько:

размеры файлов WebP более чем в два раза меньше чем их копии в форматах JPEG или PNG;
GOOGLE PAGE SPEED повышает баллы при использовании этого формата.
Проблема в том что в популярной CMS MODX Revolution, отсутствует поддержка WebP на должном уровне. Есть плагины такие как thumbOf которые умеют создавать в кэше WebP копии, но у них нет определения поддержки браузером этого формата. Еще одна трудность в том что не все графические редакторы работают с WebP. Попробуем исправить это досадное недоразумение.

Чтобы не утруждать себя лишней работой, сделаем поддержку этого формата прозрачно, т. е. Вам не придется задумываться о дополнительных копиях графических файлов на сервере. Вы как и прежде будете размещать на сайте изображения в форматах JPEG или PNG, а плагин будет создавать и обслуживать актуальные копии этих файлов в отдельном подкаталоге.


## Установка плагина WebP Converter в MODX Revo

1. **Создание каталога для плагина**
   Создайте подкаталог в корневом каталоге сайта: `/connectors/converter/`

2. **Скачивание файлов**
Скачайте содержимое каталога из репозитория:
[https://github.com/commeta/modxWebpConverter](https://github.com/commeta/modxWebpConverter)
и разместите их в `/connectors/converter/`.

3. **Создание плагина в MODX Revo**
- Зайдите в панель управления MODX Revo.
- Создайте новый плагин с названием `modx_plugin_webp_converter`.
- Вставьте содержимое файла:
  ```
  /connectors/converter/modx_plugin_webp_converter.php
  ```
  в поле **Код плагина (PHP)**.

4. **Настройка системных событий**
На вкладке **Системные события** отметьте следующие пункты:

- `OnManagerPageBeforeRender` — Запускается в контроллере менеджера перед оформлением контента.
- `OnWebPagePrerender` — Запускается после обработки всех тегов на странице, но до отправки браузеру.
- `OnSiteRefresh` — Запускается при очистке кэша всего сайта.
- `OnTemplateSave` — После сохранения шаблона.
- `OnChunkSave` — После сохранения чанка.
- `OnPluginSave` — После сохранения плагина.
- `OnSnippetSave` — После сохранения сниппета.
- `OnTemplateVarSave` — После сохранения переменной шаблона в базе данных.
- `OnDocFormSave` — После сохранения ресурса через форму редактирования в менеджере.

5. **Использование**
После сохранения плагина, в правом верхнем меню (**MODX USER MENU**) появится ссылка:  WEBP Конвертер
через которую можно работать с конвертацией изображений в формат WebP.
